function() {
    var state = this.pin.CH.getState();

    if (this.thermostat.CH.temperature > 18) {
        // Warm enough inside, so switch off regardless of other rules
        if (state === 1) {
            console.TRACE("CH", "Room is ", this.thermostat.CH.temperature,
                          " so off");
            this.setPin("CH", 0);
            // Cancel any boost requests
            this.pin.CH.purgeRequests("boost");
        }
        return;
    }

    // See if there's and demand from requests
    var req = this.pin.CH.getActiveRequest();
    if (req) {
        this.setPin("CH", req.state);
        return;
    }

    // See if it's warm enough outside not to bother with heating
    if (this.weather("Feels Like Temperature") > 14) {
        if (state === 1) {
            console.TRACE("CH", "Weather is ",
                          this.weather("Feels Like Temperature"),
                          " so off");
            this.setPin("CH", 0);
        }
        return;
    }

    // Now see if there's any demand from mobile devices
    var at_home = 0, arrive_soon = 0;
    for (var moby in this.mobile) {
        var m = this.mobile[moby];
        if (m.arrivesIn() < 5 * 60)
            at_home++;
        else if (m.arrivesIn() < 40 * 60)
            arrive_soon++;
    }

    if (at_home + arrive_soon === 0) {
        if (state === 1) {
            console.TRACE("CH", "No demand so off");
            this.setPin("CH", 0);
        }
        return;
    }
    
    // There is demand. If it's "unknown" or "at_home" only,
    // then consider the time
    if (at_home > 0
        && !Time.between('08:00', '18:00') // day
        && Time.between('22:00', '06:30') // night
       ) {
        if (state === 1)
            console.TRACE("CH",
                          "Demand is at home, and out of time band, so off");
        this.setPin("CH", 0);
        return;
    }

    // Demand is away from home, or we are in time band
    if (state === 0 && this.thermostat.CH.temperature < 16) {
        console.TRACE("CH","on");
        this.setPin("CH", 1);
        return;
    }
}
